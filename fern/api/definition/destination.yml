# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  commons: commons.yml
  source: source.yml
  pagination: pagination.yml

types:
  DestinationId:
    alias: string
    docs: Destination ID

  Destination:
    docs: |
      A destination is any endpoint to which your webhooks can be routed.
    properties:
      id:
        type: DestinationId
        docs: ID of the destination
      team_id:
        type: commons.TeamId
        docs: ID of the workspace
      name:
        type: string
        docs: A unique, human-friendly name for the destination
      url:
        type: string
        docs: HTTP endpoint of the destination
      cli_path:
        type: string
        docs: Path for the CLI destination
      rate_limit:
        type: integer
        docs: |
          Limit event attempts to receive per period. 
          Max value is workspace plan's max attempts thoughput.
      rate_limit_period:
        type: commons.Period
        docs: Period to rate limit attempts. Defaults to second.
      archived_at:
        docs: Date the source was archived
        type: datetime
      updated_at:
        docs: Date the source was last updated
        type: datetime
      created_at:
        docs: Date the source was created
        type: datetime

  AllDestinations:
    extends: pagination.Pagination
    properties:
      count: integer
      models: list<Destination>

  DestinationRequest:
    properties:
      name:
        type: string
        docs: Name for the destination
      url:
        type: string
        docs: Endpoint of the destination
      cli_path:
        type: string
        docs: Path for the CLI destination
      rate_limit:
        type: integer
        docs: Limit event attempts to receive per period. Max 100/second or 6000/minute
      rate_limit_period:
        type: string
        docs: Period to rate limit attempts (second, minute or hour)

services:
  http:
    DestinationService:
      docs: |
        A destination is any endpoint to which your webhooks can be routed.
      auth: true
      base-path: /destinations
      endpoints:
        retrieveAllDestinations:
          method: GET
          path: /
          query-parameters:
            id:
              type: DestinationId
              docs: Filter by destination IDs
            name:
              type: string
              docs: The destination name
            archived:
              type: boolean
              docs: Include archived resources in the response
            archived_at:
              type: datetime
              docs: Date the destination was archived
            url:
              type: string
              docs: HTTP endpoint of the destination
            cli-path:
              type: string
              docs: Path for the CLI destination
            limit:
              type: integer
              docs: Limit the returned source count (max 250)
          response: AllDestinations

        retrieveDestination:
          docs: This endpoint retrieves a specific destination.
          method: GET
          path: /{id}
          path-parameters:
            id:
              type: DestinationId
              docs: This endpoint retrieves a specific destination.
          response: Destination

        createDestination:
          docs: |
            This endpoint creates a destination. 
            One of url or cli_path is required.
          method: POST
          path: /
          request: DestinationRequest
          response: Destination

        upsertDestination:
          docs: This endpoint creates a destination, or updates an existing destination by name.
          method: PUT
          path: /
          request: DestinationRequest
          response: Destination

        updateDestination:
          docs: This endpoint updates a destination.
          method: PUT
          path: /{id}
          path-parameters:
            id: DestinationId
          request: DestinationRequest
          response: Destination

        archiveDestination:
          docs: |
            This endpoint archives a destination.
            The parameter archived_at is set to the current timestamp.
          method: PUT
          path: /{id}/archive
          path-parameters:
            id: DestinationId
          response: Destination

        unarchiveDestination:
          docs: |
            This endpoint unarchives a destination. 
            The parameter archived_at is set to null.
          method: PUT
          path: /{id}/unarchive
          path-parameters:
            id: DestinationId
          response: Destination
